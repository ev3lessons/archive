<!DOCTYPE html>
<html>

  <img id="mat" src="head.jpg" width="1024" style="display:none;width:1024;
				      height:auto;position: fixed;    bottom: -10000;   left: -100000" alt="The Mat">

  <img style="display:none;" id="tmpimgholder">

  <canvas style="display:none" id="tmpCanvas" width="944" height="530"></canvas>

  <a style="display:none" download="myPlan.png" target="_blank" href="" id="downloadPic">Download to myImage.jpg</a>



  <style>
    .no-mobile {
	display: inline !important;
    }

  </style>

<head>

  <a id="sampurl" download="canvas.png"></a>
  <link rel="icon" type="image/vnd.microsoft.icon"  href="/favicon.ico" />
  <link rel="Stylesheet" type="text/css" href="./demo/demo.css" />
  <link rel="Stylesheet" type="text/css" href="./style.css" />
  <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
  <link rel="stylesheet" href="jquery.mobile-1.4.5.min.css" />
  <script src="jquery.mobile-1.4.5.min.js"></script>
  <script src="jqm-spinbox.min.js"></script>


  <!-- fileend -->

  <!-- headstart -->





  <center>
  </center>

  <div class="content-box">
    <!-- JavaScripts-->
    <!-- jQuery UI -->
    <script type="text/javascript" src="./lib/jquery.ui.core.1.10.3.min.js"></script>
    <script type="text/javascript" src="./lib/jquery.ui.widget.1.10.3.min.js"></script>
    <script type="text/javascript" src="./lib/jquery.ui.mouse.1.10.3.min.js"></script>
    <script type="text/javascript" src="./lib/jquery.ui.draggable.1.10.3.min.js"></script>
    <link rel="Stylesheet" type="text/css" href="./lib/wColorPicker.min.css" />

    <!-- wColorPicker -->
    <script type="text/javascript" src="./lib/wColorPicker.min.js"></script>
    <!-- wPaint -->
    <link rel="Stylesheet" type="text/css" href="./wPaint.min.css" />
    <script type="text/javascript" src="./wPaint.min.js"></script>
    <script type="text/javascript" src="./plugins/main/src/wPaint.menu.main.js"></script>
    <script type="text/javascript" src="./plugins/text/wPaint.menu.text.min.js"></script>
    <script type="text/javascript" src="./plugins/shapes/wPaint.menu.main.shapes.min.js"></script>
    <script type="text/javascript" src="./plugins/file/wPaint.menu.main.file.min.js"></script>


    <style>
      #container {
	  position: relative;
      }

      #holder {
	  position: absolute;
	  top: 0px;
	  left: 0px;

	  padding: 5px;
	  //  background-color: white;
	  //  border: 2px solid red;
      }
    .button:hover {
        //background-color: #4CAF50 !important; /* Green */
        //color: white;
        border-style: solid;
        border-width: 5px;
        border-color: green !important;
    }
    .button:active {
        //background-color: #4CAF50 !important; /* Green */
        //color: white;
        border-style: solid;
        border-width: 5px;
        border-color: black !important;
    }
    </style>
    <title> FLL CITY SHAPER Sketch Planner</title>
</head>
    <div data-role="tabs">
      <div data-tap-toggle="false" data-role="header" data-position="fixed" style="z-index: 20000000000000000000000000000">
	<div data-role="navbar">
          <ul>
            <li><a onclick="document.getElementById('wPaint').style.zIndex = 1; document.getElementById('wPaint-canvas').style.pointerEvents = ''" href="#fragment-1" class="ui-btn-active">Draw</a></li>
            <li><a onclick="document.getElementById('wPaint').style.zIndex = -1; document.getElementById('wPaint-canvas').style.pointerEvents = 'none'" href="#fragment-2">Saves</a></li>
          </ul>
	</div>
      </div>

      <div id="fragment-1">
	<div data-type="horizontal" data-role="controlgroup" style="position:relative;z-index: 200000000000000000000000000000000000000000000000000000000">
	  <button data-inline="true" class="button" onclick="$('#wPaint').wPaint('setStrokeStyle','yellow');$('#wPaint').wPaint('setLineWidth',3);" style="background-color: yellow; width: 20px; height: 20px;
																			   background-size: contain;  background-position: center;
																			   background-repeat: no-repeat;"> </button>

	  <button data-inline="true" class="button" onclick="$('#wPaint').wPaint('setStrokeStyle','green');$('#wPaint').wPaint('setLineWidth',3);" style="background-color: green; width: 20px; height: 20px;   background-size: contain;  background-position: center;
																			  background-repeat: no-repeat;"> </button>

	  <button class="button" onclick="$('#wPaint').wPaint('setStrokeStyle','red');$('#wPaint').wPaint('setLineWidth',3);" style="background-color: red; width: 20px; height: 20px;   background-size: contain;  background-position: center;
																     background-repeat: no-repeat;"> </button>
	  <button class="button" onclick="$('#wPaint').wPaint('setStrokeStyle','blue');$('#wPaint').wPaint('setLineWidth',3);" style="background-color: blue; width: 20px; height: 20px;   background-size: contain;  background-position: center;
																      background-repeat: no-repeat;"> </button>
	  <button class="button" onclick="$('#wPaint').wPaint('setStrokeStyle','orange');$('#wPaint').wPaint('setLineWidth',3);" style="background-color: orange; width: 20px; height: 20px;   background-size: contain;  background-position: center;
																	background-repeat: no-repeat;"> </button>
	  <button class="button" onclick="$('#wPaint').wPaint('setStrokeStyle','brown');$('#wPaint').wPaint('setLineWidth',3);" style="background-color: brown; width: 20px; height: 20px;   background-size: contain;  background-position: center;
																       background-repeat: no-repeat;"> </button>
	  <button class="button" onclick="$('#wPaint').wPaint('setStrokeStyle','black');$('#wPaint').wPaint('setLineWidth',3);" style="background-color: black; width: 20px; height: 20px;   background-size: contain;  background-position: center;
																       background-repeat: no-repeat;"> </button>
	  <button class="button" onclick="$('#wPaint').wPaint('setStrokeStyle','white');$('#wPaint').wPaint('setLineWidth',3);" style="background-color: white; width: 20px; height: 20px;   background-size: contain;  background-position: center;
																       background-repeat: no-repeat;"> </button>
	  <button class="button" onclick="$('#wPaint').wPaint('setMode','eraser');$('#wPaint').wPaint('setLineWidth',10);" style="background: url(eraser-icon-5.png); background-color: grey;width: 20px; height: 20px;   background-size: contain;  background-position: center;
																  background-repeat: no-repeat;"> </button>
	  <button class="button" onclick="$('#wPaint').wPaint('clear');" style="background: url(clear.png); background-color: grey;width: 20px; height: 20px;   background-size: contain;  background-position: center;
										background-repeat: no-repeat;"> </button>
	  <button class="button" onclick="$('#wPaint').wPaint('undo');" style="background: url(undo.png); background-color: grey;width: 20px; height: 20px;   background-size: contain;  background-position: center;
									       background-repeat: no-repeat;"> </button>
	  <button class="button" onclick="$('#wPaint').wPaint('redo');" style="background: url(redo.png); background-color: grey;width: 20px; height: 20px;   background-size: contain;  background-position: center;
									       background-repeat: no-repeat;"> </button>
	  <button class="button" onclick="$('#wPaint').wPaint('setMode','pencil'); $('#wPaint').wPaint('setLineWidth',3);" style="background: url(pencil.png); background-color: grey;width: 20px; height: 20px;   background-size: contain;  background-position: center;
																  background-repeat: no-repeat;"> </button>
	  <button class="button" onclick="$('#wPaint').wPaint('setMode','line'); $('#wPaint').wPaint('setLineWidth',3);" style="background: url(line.png); background-color: grey;width: 20px; height: 20px;   background-size: contain;  background-position: center;
																background-repeat: no-repeat;"> </button>
	  <button class="button" onclick="$('#wPaint').wPaint('setMode','rectangle'); $('#wPaint').wPaint('setLineWidth',3);$('#wPaint').wPaint('setFillStyle','transparent');" style="background: url(rectangle.png); background-color: grey;width: 20px; height: 20px;   background-size: contain;  background-position: center;
																						       background-repeat: no-repeat;"> </button>
	  <button class="button" onclick="$('#wPaint').wPaint('setMode','text'); $('#wPaint').wPaint('setFontSize','25');$('#wPaint').wPaint('setFillStyle','red');" style="background: url(text.png); background-color: grey;width: 20px; height: 20px;   background-size: contain;  background-position: center;
																					    background-repeat: no-repeat;"> </button>
	</div>
      </div>


      <script>

	width = window.innerWidth
	//height = String((width*530/944)-100)
	//height = String((width*530/944))
	height = window.innerHeight - 100

	if (width < height*944/530) {
	    height = width * 530/944
	}
	if (height < width*530/944) {
	    width = height * 944/530
	}
	
	//  width = String(width)
	//  height = screen.height-100

	//  width = String(height*944/530)
	//  height = String(height)

	// width = window.innerWidth
	// height = window.innerHeight-100

	//944x530
	//    document.write('<div  id="wPaint" style="position:fixed;    width:80%; top:0px;height:auto%; background-color:#7a7a7a; margin:70px auto    20px auto;">');

	// document.write('<div  id="wPaint" style="position:fixed;    width:944px; height:530px; top:0px;height:auto%; background-color:#7a7a7a; margin:70px auto    20px auto;">');

	//document.write('<div  id="wPaint" style="position:fixed;    top:20px; background-color:#7a7a7a; margin:70px auto    20px auto;">');
	document.write('<div  id="wPaint" style="position:fixed;   width:'+width+'px; height:'+height+'px; top:20px;height:auto%; background-color:#7a7a7a; margin:70px auto    20px auto;z-index:1">');

																							     </script>
      <!-- height="100%" width="100%"-->
      <div id="container" >
	<img src="head.jpg" style="width: 100%;  height:auto;">
	<div id="holder" style="z-index: 1">
	</div>
      </div>
    </div>
    <div id="fragment-2" style="position:relative; z-index:90">
      <button class="button" onclick="svimg(); mymax = window.localStorage.canvasImage.split('|').length-1; alert('saved')"data-inline="true" style="">Save Drawing</button>
      <button onclick="window.localStorage.canvasImage = ''; document.getElementById('saveid').max = 1 ; alert('deleted all saves')"data-inline="true">Delete All Saves</button>

      <br>

      <table>
	<tr>
	  <td>
	    <button data-inline="true"
		    onclick="
			     loadsave(window.localStorage.canvasImage.split('|')[parseInt(document.getElementById('saveid').value)]);
			     loadsave(window.localStorage.canvasImage.split('|')[parseInt(document.getElementById('saveid').value)]);
			     setTimeout(function() {
			     loadsave(window.localStorage.canvasImage.split('|')[parseInt(document.getElementById('saveid').value)]);
			     }, 200);
			     alert('loaded');
			     ">Load save #</button>
	  </td>
	  <td>
	    <script>
	      if (window.localStorage.canvasImage == undefined) {
		  window.localStorage.canvasImage = ''
	      }
	      mymax = window.localStorage.canvasImage.split('|').length-1;
	      document.write('<input  id="saveid" type="text" data-inline="true" data-role="spinbox" onchange="if (mymax < this.value) {this.value = mymax} " min="1" value="1">')</script>
																						 </td>
	</tr>
      </table>

      <br>
      <br>
      <a style="display:none;x position: fixed;    bottom: -10000;   left: -100000;"id="export" href="#">Export Saves</a>
      <button data-inline="true" class="ui-mini no-mobile" onclick="document.getElementById('export').click(); document.getElementById('export2').click()">Export Saves</button>
      <script type="text/javascript">
        var anchor = document.getElementById('export');
        anchor.onclick = function() {
            var currentTime = new Date()
            var day = currentTime.getDate()
            anchor.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(window.localStorage.canvasImage);
            anchor.download = day + 'myscores.DRCI';
            //     setTimeout(function(){   ;  anchor.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(window.localStorage.DRAA1scorer);    anchor.download = day + 'myscores.AA1EV3';}, 50)
        };
      </script>

      <button class="ui-mini no-mobile" data-inline="true" onclick="// alert('choose .DRCI file') ;
								    document.getElementById('fileInput').click() ">Import Save File</button>

      <button data-inline="true" class="no-mobile" onclick="exporter();">Export Drawing as PNG</button>
      <input onchange="" style=" display:none; position: fixed;    bottom: -10000;   left: -100000; }, 30);" type="file" id="fileInput"><br>
      <!--Drawplan Scoring System Version 4.1.0 Beta<br>-->
     <p style="
      z-index: 99;position: relative;"> Drawplan CITY SHAPER Verison
      2.1</p>


        <a target="_blank" class="no-print"
  href="https://play.google.com/store/apps/details?id=com.ev3lessons.fllcityshapersketchplanner">
  <img id="googleplay" height="100" 
       src="google-play/en_get.svg"></a><br>

  <a target="_blank" class="no-print"
    href="https://apps.apple.com/app/fll-city-shaper-sketch-planner/id1476772135?ls=1">
    <img id="appstore" height="68" style="padding: 15px" 
      src="app-store/en.svg"></a>


    </div>
  </div>
</div>
<center><article>

    <p><input style="position: fixed; top:-100px;" id="imageLoader" name="imageLoader" type="file"></p>
    <i style="display: none;" id="status">File API &amp; FileReader API not supported</i>
</article></center>

<center id="wPaint-img"></center>
<script type="text/javascript">
  function OpenInNewTab(url) {
      var win = window.open(url, '_blank');
      win.focus();
  }
  var dataUrl;
  var imageData = $("#wPaint").wPaint("image");

  $("#canvasImage").attr('src', imageData);
  $('#wPaint').wPaint('image', '<image_data>');

  var images = [
      'head.jpg',
  ];

  function saveImg() {}

  function svimg() {
      //      var imgCanvas = document.getElementById('wPaint-canvas');
      //     var imgAsDataURL = imgCanvas.toDataURL("image/png");


      realimgCanvas = document.getElementById('wPaint-canvas');
      imgCanvas = document.getElementById('tmpCanvas');
      var ctx = imgCanvas.getContext("2d");

      img = document.getElementById("mat");
      ctx.drawImage(img, 0, 0,tmpCanvas.width,tmpCanvas.height);

      var origCtx = imgCanvas.getContext('2d');

      ctx.drawImage(realimgCanvas, 0, 0,tmpCanvas.width,tmpCanvas.height);

      imgAsDataURL = imgCanvas.toDataURL("image/png");
      
      window.localStorage.canvasImage = window.localStorage.canvasImage + '|' + imgAsDataURL;
  }


  function loadImgBg () {
  }

  function loadImgFg () {
  };



  function loadsave(data) {
      document.getElementById('tmpimgholder').src =  data;
      var c = document.getElementById("wPaint-canvas");
      var ctx = c.getContext("2d");
      var img = document.getElementById("tmpimgholder");
      ctx.drawImage(img,0,0,c.width,c.height);

  }




  // init wPaint
  $('#wPaint').wPaint({
      path: './',
      menuOffsetLeft: -35,
      menuOffsetTop: -50,
      saveImg: saveImg,
      loadImgBg: loadImgBg,
      loadImgFg: loadImgFg,
  });
  $(function() {
      $("#btnSave").click(function() {
	  html2canvas($("#widget"), {
	      onrendered: function(canvas) {
		  theCanvas = canvas;
		  document.body.appendChild(canvas);

		  // Convert and download as image
		  Canvas2Image.saveAsPNG(canvas);
		  $("#img-out").append(canvas);
		  // Clean up
		  //document.body.removeChild(canvas);
	      }
	  });
      });
  });



  </script>
<script>
  //var img;
  var imageLoader = document.getElementById('imageLoader');
  imageLoader.addEventListener('change', handleImage, false);
  var canvas = document.getElementById('wPaint-canvas');
  var ctx = canvas.getContext('2d');


  function handleImage(e){
  }


</script>
<script>





  function exporter() {
      realimgCanvas = document.getElementById('wPaint-canvas');
      imgCanvas = document.getElementById('tmpCanvas');
      imgAsDataURL = imgCanvas.toDataURL("image/png");
      var ctx = imgCanvas.getContext("2d");

      img = document.getElementById("mat");
      ctx.drawImage(img, 0, 0,tmpCanvas.width,tmpCanvas.height);

      var origCtx = imgCanvas.getContext('2d');

      ctx.drawImage(realimgCanvas, 0, 0,tmpCanvas.width,tmpCanvas.height);

      link = document.getElementById("downloadPic")
      link.href = imgCanvas.toDataURL("image/jpg");
      link.click()
  }
  
  image = ''
  function rewrite() {}

  function download() {}




  window.onload = function() {
      //document.getElementById('noshark').click()
      //    check_missions('shark');recalc(0,'shark',1);$('#noallsamples').checkboxradio('disable');$('#yesallsamples').checkboxradio('disable');
      var fileInput = document.getElementById('fileInput');
      fileInput.addEventListener('change', function(e) {
	  var file = fileInput.files[0];
	  var textType = /text.*/;
	  if (1==1) {
              var reader = new FileReader();
              reader.onload = function(e) {
		  data = reader.result;
		  //alert(data)
		  window.localStorage.canvasImage = data;
		  alert('Imported. Please Refresh to load a Save/Make new Saves')
              }
              reader.readAsText(file);
	  } else {
	  }
      });
  }

</script>
</div>
</div>

</footer>
<!-- footend -->
</body>

</html>
</div>
<style>
  .wPaint-menu {
      display: none
  }
</style>

</html>
